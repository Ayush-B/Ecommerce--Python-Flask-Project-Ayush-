{% extends "layouts/base.html" %}

{% block content %}
<div class="ui centered grid" style="margin-top: 4em;">
    <div class="eight wide column">
        <h2 class="ui header">Create an Account</h2>

        <form id="registerForm" class="ui form">
            <div class="field">
                <label>Email</label>
                <input type="email" name="email" required placeholder="you@example.com">
            </div>

            <div class="field">
                <label>Password</label>
                <input type="password" name="password" required placeholder="Choose a secure password">
            </div>

            <button type="submit" class="ui primary button fluid">Create Account</button>

            <div id="registerError" class="ui red message hidden" style="margin-top: 1em;"></div>

            <div class="ui divider"></div>

            <p>Already have an account?
                <a href="{{ url_for('auth.login_page') }}">Sign in here</a>
            </p>
        </form>
    </div>
</div>

<script>
document.querySelector("#registerForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const errorBox = document.getElementById("registerError");
    errorBox.classList.add("hidden");

    const payload = {
        email: this.email.value,
        password: this.password.value
    };

    const resp = await fetch("{{ url_for('auth.register') }}", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    });

    const data = await resp.json();

    if (!resp.ok) {
        errorBox.textContent = data.error || "Account creation failed";
        errorBox.classList.remove("hidden");
        return;
    }

    // After register, log them in automatically
    window.location.href = "/";
});
</script>
{% endblock %}
